apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-afyatrack
  namespace: afyatrack-ke
data:
  afyatrack-dashboard.json: |-
    {
      "id": null,
      "title": "AfyaTrack KE Metrics",
      "tags": ["afyatrack", "kenya", "hospital"],
      "timezone": "browser",
      "panels": [
        {
          "id": 1,
          "title": "HTTP Requests Rate",
          "type": "graph",
          "targets": [
            {
              "expr": "rate(http_requests_total[5m])",
              "legendFormat": "{{method}} {{route}} {{status_code}}"
            }
          ],
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 0 }
        },
        {
          "id": 2,
          "title": "Total Hospital Registrations",
          "type": "stat",
          "targets": [
            {
              "expr": "hospital_registrations_total",
              "legendFormat": "Total Registrations"
            }
          ],
          "gridPos": { "h": 4, "w": 6, "x": 0, "y": 8 }
        },
        {
          "id": 3,
          "title": "Application Uptime",
          "type": "stat",
          "targets": [
            {
              "expr": "up{job=\"afyatrack-app\"}",
              "legendFormat": "Instance {{instance}}"
            }
          ],
          "gridPos": { "h": 4, "w": 6, "x": 6, "y": 8 }
        },
        {
          "id": 4,
          "title": "Memory Usage",
          "type": "gauge",
          "targets": [
            {
              "expr": "process_resident_memory_bytes / 1024 / 1024",
              "legendFormat": "{{app}}"
            }
          ],
          "gridPos": { "h": 6, "w": 6, "x": 0, "y": 12 }
        }
      ],
      "time": { "from": "now-6h", "to": "now" }
    }
